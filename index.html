<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="images/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="stylesheet" href="css/hyperaudio-lite-player.css">
 

  <!-- DaisyUI / Tailwind -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.2/dist/full.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>

    p {
      padding-bottom: 1.5em;
      line-height: 1.8;
    }

    .side-panel {
      background-color: #efefef;
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      padding: 8px;
      overflow-y: hidden;
      width: 400px;
      transition: left 0.5s ease;
    }

    .side-panel h1 {
      color: white;
    }

    .main-panel {
      position: absolute; 
      left:400px; 
      right:0;
      transition: left 0.5s ease;
    }

    #speaker-display {
      margin-top: -30px;
      text-align: right;
      padding-right: 20px;
    }

    [contenteditable]:focus {
      outline: 0px solid transparent;
    }

    .caption {
      content-visibility:auto; 
      contain-intrinsic-size: auto 300px;
      height:300px;
    }
    
  </style>
   <link rel="stylesheet" href="css/hyperaudio-lite-editor.css">
</head>
<body data-theme="light">

  <div class="transcript-holder">

  </div>

  <!-- templates -->

  <template id="caption-template-holder">
    <div id="caption-template" class="caption">
      <div class="caption-row">
        <button class="play btn btn-primary btn-sm" onclick="playClip(this)">play clip <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>
      </div>
      <div class="caption-row">
        <button class="play-start btn btn-outline btn-xs" onclick="seekTo(this)" style="margin-right:4px"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-skip-forward"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" x2="19" y1="5" y2="19"></line></svg></button><input class="start" value="" oninput="captionChange()">(In)
      </div>
      <div class="caption-row">
        <button class="play-end btn btn-outline btn-xs" onclick="seekTo(this)" style="margin-right:4px"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-skip-forward"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" x2="19" y1="5" y2="19"></line></svg></button><input class="end" value="" oninput="captionChange()">(Out)
      </div>
      <div class="caption-row">
        <input class="line1" value="" oninput="captionChange()">
      </div>
      <div class="caption-row">
        <input class="line2" value="" oninput="captionChange()">
      </div>
      <div class="caption-row btn-group btn-group-horizontal">
        <button class="btn btn-outline btn-xs" onclick="addCaption(this)">insert <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down-to-line"><line x1="12" x2="12" y1="17" y2="3"></line><polyline points="6 11 12 17 18 11"></polyline><path d="M19 21H5"></path></svg></button>
        <button class="btn btn-outline btn-xs" onclick="mergeCaption(this)">merge <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down-from-line"><line x1="12" x2="12" y1="21" y2="7"></line><polyline points="6 15 12 21 18 15"></polyline><path d="M19 3H5"></path></svg></button>
        <button class="btn btn-outline btn-xs" onclick="deleteCaption(this)">delete <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg></button>
      </div>
      <div class="divider"></div>
    </div>
  </template>

  <!-- end of templates -->

  <div class="holder grid grid-flow-col auto-cols-max">
    <div class="side-panel">
      <div>
        <div class="top-bar-item">
          <!-- example src -->
          <div>
            <video id="hyperplayer" class="hyperaudio-player" src="https://lab.hyperaud.io/video/HALiteIntro.mp4" type="video/mp4" controls poster="images/poster.png" style="width:400px; margin-left: -8px;">
              <track id="hyperplayer-vtt" label="preview" kind="subtitles" src="">
            </video>
          </div>
        </div>

        <div class="top-bar-item">
          <div id="pbr-holder" style="display: grid; grid-template-columns: 0.65fr 1.05fr 0.3fr; grid-gap: 10px;">
            <div>
              <label for="pbr">Playback Rate</label>
            </div>
            <div>
              <input id="pbr" type="range" min="0.4" max="2.4" value="1" step="0.2" class="range range-md range-primary" />
              <!--<div class="w-full flex justify-between text-xs px-2">-->
            </div>

            <div style="padding-right: 12px;">
              <div class="hidden-label-holder">
                <label style="width:0px;position:absolute;top:-100px" for="currentPbr">Playback Rate Value</label>
              </div>
              <input id="currentPbr" class="input input-bordered input-xs w-full max-w-xs" style="width:60px" type="number" id="pbr" name="pbr" value="1" step="0.2" min="0.4" max="2.4">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-panel" style="z-index: 2">
      <div class="navbar bg-base-100" style="background-color: #ffffff; opacity:0.95;">
        <div class="navbar-start">
          <button id="sidebar-toggle" class="btn btn-square btn-outline" aria-label="Toggle Sidebar">
            <svg id="sidebar-close-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sidebar-close"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><path d="M9 3v18"></path><path d="m16 15-3-3 3-3"></path></svg>
            <svg id="sidebar-open-icon" style="display: none" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sidebar-open"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><path d="M9 3v18"></path><path d="m14 9 3 3-3 3"></path></svg>
          </button>
          &nbsp;
          <button id="strikethrough" class="btn btn-square btn-outline" aria-label="Strike through text">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-strikethrough"><path d="M16 4H9a3 3 0 0 0-2.83 4"/><path d="M14 12a4 4 0 0 1 0 8H6"/><line x1="4" x2="20" y1="12" y2="12"/></svg>
          </button>
          <div class="dropdown menu-compact">
            <label tabindex="0" class="btn m-1 btn-outline gap-2">
              <span id="file-dropdown-text">FILE</span>
              <svg id="file-dropdown-symbol" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
              <svg id="file-dropdown-symbol-mobile" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </label>
            <ul id="file-dropdown" tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
              <li class="menu-title">
                <span>
                  Upload
                </span>
              </li>
              <li><a id="upload-transcribe-btn">Upload & Transcribe</a></li>
              <hr
              class="my-2 h-0 border border-t-0 border-solid border-neutral-700 opacity-25 dark:border-neutral-200" />
              <li class="menu-title">
                <span>
                  Download as
                </span>
              </li>
              <li><a id="download-vtt" href="" download="hyperaudio.vtt">WebVTT (Captions)</a></li>
              <li><a id="download-srt" href="" download="hyperaudio.srt">SRT (Captions)</a></li>
              <li><a id="download-html" href="" download="hypertranscript.html">HTML</a></li>
              <li><a id="download-hypertranscript" href="" download="hyperaudio.html">Interactive Transcript</a></li>
              <li><a id="download-wav-cut">WAV</a></li>
              <hr
              class="my-2 h-0 border border-t-0 border-solid border-neutral-700 opacity-25 dark:border-neutral-200" />
              <li class="menu-title">
                <span>
                  Export / Import
                </span>
              </li>
              <li><export-json></export-json></li>
              <li><import-json></import-json></li>
              <li><label for="file-import-deepgram-json-dialog">Import Deepgram JSON</label></li>
              <li><label for="file-import-srt-dialog">Import SRT</label></li>
              <li><label for="file-import-vtt-dialog">Import VTT</label></li>
            </ul>
          </div>
        </div>
        <div class="navbar-center">
          <div class="form-control">
            <input id="search-box" type="text" placeholder="Search" class="input input-bordered" />
          </div>
        </div>
        <div class="navbar-end" style="padding-right: 8px;">
          <button id="caption-editor-btn" class="btn btn-square btn-outline" style="margin-right:4px">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-subtitles"><path d="M7 13h4"></path><path d="M15 13h2"></path><path d="M7 9h2"></path><path d="M13 9h4"></path><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10Z"></path></svg>
          </button>
          <button id="transcript-editor-btn" class="btn btn-square btn-outline" style="margin-right:4px" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
          </button>
          <input type="checkbox" id="captions-modal" class="modal-toggle" />
          <div class="modal" style="content-visibility: hidden;">
            <div class="modal-box relative">
              <label for="captions-modal" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
              <button id="regenerate-btn" class="btn btn-disabled btn-outline btn-primary">Re-generate Captions from Transcript <svg id="regenerate-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list-restart"><path d="M21 6H3"></path><path d="M7 12H3"></path><path d="M7 18H3"></path><path d="M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14"></path><path d="M11 10v4h4"></path></svg></button>
              <div id="caption-editor">
                <center>Preparing captions....</center>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="captionsource-alert" class="alert alert-info shadow-lg" style="visibility:hidden; z-index:2; position:absolute; top:50%; left:50%; width:480px; height:140px; margin: -240px 0 0 -240px;">
      <div>
        <div style="margin-top:-60px; width:400px">
          <h3 class="font-bold">Captions have been edited.</h3>
          <div class="text-xs">These captions may differ from the transcript. You can re-generate captions from the transcript in the Caption Editor.</div>
        </div>
      </div>
      <div class="modal-action" style="margin-top:80px; margin-left:-120px">
        <button id="captionsource-alert-cancel" class="btn btn-sm btn-secondary">don't tell me again</button>
        <button id="captionsource-alert-ok" class="btn btn-sm btn-primary">ok</button>
      </div>
    </div>
  </div>

  <script src="js/caption-modified.js"></script>
  <script>

  let updateCaptionsFromTranscript = true;
  let captionMode = true; // used to detect whether we need to sanitise amongst other things
  let transcriptRequiresInit = false; // to know whether a transcript has been loaded while in captionMode and so not initialised

  let alertOkBtn = document.querySelector('#captionsource-alert-ok');

  alertOkBtn.addEventListener('click', function() {
    document.querySelector('#captionsource-alert').style.visibility = "hidden";
  });

  let alertCancelBtn = document.querySelector('#captionsource-alert-cancel');

  alertCancelBtn.addEventListener('click', function() {
    document.querySelector('#captionsource-alert').style.visibility = "hidden";
    localStorage.setItem("noCaptionAlert", "true");
  });

  /* ----------------------------------------------------------- */

  document.querySelector('#caption-editor-btn').addEventListener('click', (e) => {
    captionMode = true;
    document.querySelector('#caption-editor-btn').disabled = true;
    document.querySelector('#transcript-editor-btn').disabled = false;
  });

  document.querySelector('#transcript-editor-btn').addEventListener('click', (e) => {
    restoreTranscript();
    captionMode = false;
    if (transcriptRequiresInit === true) {
      hyperaudio();
      transcriptRequiresInit = false;
    }
    
    document.querySelector('#caption-editor-btn').disabled = false;
    document.querySelector('#transcript-editor-btn').disabled = true;
  });
  </script>

  <import-srt></import-srt>
  <import-vtt></import-vtt>
  
  <script src="./js/hyperaudio-lite-editor-export.js" type="module"> </script>

  <style>
    input.line1 {
      width: 36ch;
    }

    input.line2 {
      width: 36ch;
    }

    div.caption {
      padding: 16px;
    }

    .caption-row {
      padding: 4px;
    }

    #captions-display {
      width: 520px;
      padding-top: 40px;
    }

  </style>
  <script>
    window.document.addEventListener('hyperaudioPopulateCaptionEditor', populateCaptionEditor, false);

    function populateCaptionEditor(data) {

      let holder = null;

      // only actually inject the caption HTML if we are in "captionMode"
      if (captionMode === true) {
        holder = document.querySelector('.transcript-holder');
      } else {
        holder = document.createElement('div');
        holder.className = 'transcript-holder';
      }
      
      holder.innerHTML = '<div class="modal-action"><label id="regenerate-btn" for="regenerate-captions-modal" class="fixed bottom-8 right-8 btn btn-outline btn-primary" >Regenerate <svg id="regenerate-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list-restart"><path d="M21 6H3"></path><path d="M7 12H3"></path><path d="M7 18H3"></path><path d="M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14"></path><path d="M11 10v4h4"></path></svg></label></div>';

      let newDiv = document.createElement('div');

      // Set an id for the new div
      newDiv.id = 'captions-display';

      // Append the new div to the existing div

      holder.insertAdjacentElement('beforeEnd', newDiv);
    
      // Initialize the DOM parser
      let parser = new DOMParser();
      let html = document.querySelector('#caption-template-holder').innerHTML;

      // Parse the text
      let template = parser.parseFromString(html, "text/html");

      let index = 0;
      data.forEach(cap => {
        let line1 = cap.text.split('\n')[0];
        let line2 = cap.text.split('\n')[1];

        if (line2 === undefined || typeof line2 === "undefined") {
          line2 = "";
        }

        let captionTempl = template.querySelector('#caption-template').cloneNode(true);
        captionTempl.id = "caption-"+index;
        index++;
        captionTempl.querySelector('.start').value = cap.start;
        captionTempl.querySelector('.end').value = cap.stop;
        captionTempl.querySelector('.line1').value = line1;
        captionTempl.querySelector('.line2').value = line2;

        holder.querySelector('#captions-display').insertAdjacentElement('beforeEnd', captionTempl);
        //document.querySelector('#captions-display').insertAdjacentElement('beforeEnd', captionTempl);
      });
    } 

    function captureCaptions(holder) {
      // Get the form element
      const form = holder;
      
      // Create a deep clone of the form
      const formClone = form.cloneNode(true);
      
      // Update all input values in the clone to match current values
      const inputs = form.querySelectorAll('input, textarea, select');
      const clonedInputs = formClone.querySelectorAll('input, textarea, select');
      
      inputs.forEach((input, index) => {
          const clonedInput = clonedInputs[index];
          
          if (input.type === 'checkbox' || input.type === 'radio') {
              clonedInput.checked = input.checked;
              if (input.checked) {
                  clonedInput.setAttribute('checked', 'checked');
              } else {
                  clonedInput.removeAttribute('checked');
              }
          } else if (input.tagName === 'SELECT') {
              Array.from(input.options).forEach((option, optIndex) => {
                  clonedInput.options[optIndex].selected = option.selected;
                  if (option.selected) {
                      clonedInput.options[optIndex].setAttribute('selected', 'selected');
                  } else {
                      clonedInput.options[optIndex].removeAttribute('selected');
                  }
              });
          } else {
              clonedInput.value = input.value;
              clonedInput.setAttribute('value', input.value);
          }
      });
      
      // Get the HTML string
      const formHTML = formClone.innerHTML;
      
      // Log or use the HTML string as needed
      return formHTML;
    }

    function populateCaptionEditorFromVtt(vtt) {
      const data = [];
      vtt = vtt.replace("WEBVTT\n\n","");
      vtt = vtt.replaceAll("\n\n","\n");

      let lines = vtt.split('\n');
      let start, stop, text;

      lines.forEach((line, index) => {
        let lineIsNumber = !isNaN(line.trim().replace(' --> ','').replaceAll('.','').replaceAll(':',''));
        if (lineIsNumber === true && line.indexOf(' --> ') === 12 && line.length === 29) {
          if (index > 0) {
            data.push({start, stop, text});
          }
          start = line.split(' --> ')[0];
          stop = line.split(' --> ')[1].trim();
          text = "";
        } else {
          text += line.trim() + "\n";
        }
      });

      populateCaptionEditor(data);

      if (updateCaptionsFromTranscript === false && localStorage.getItem("noCaptionAlert") !== "true") {
        document.querySelector('#captionsource-alert').style.visibility = 'visible';
      }
    }

    const countSeconds = (str) => {
      const [hh = '0', mm = '0', ss = '0'] = (str || '0:0:0').split(':');
      const hour = parseInt(hh, 10) || 0;
      const minute = parseInt(mm, 10) || 0;
      const second = parseFloat(ss);
      return (hour*3600) + (minute*60) + (second);
    };

    function playClip(elem) {

      let startTime = countSeconds(elem.parentElement.parentElement.querySelector('.start').value);
      let endTime = countSeconds(elem.parentElement.parentElement.querySelector('.end').value);
      let duration = endTime - startTime;

      document.querySelector('video').currentTime = startTime;
      document.querySelector('video').play();

      let clipTimer = setInterval(function(){
        if(document.querySelector('video').currentTime > endTime){
          document.querySelector('video').pause();
          clearInterval(clipTimer);
        }
      },100);
    }

    function seekTo(elem) {
      let seekTime = countSeconds(elem.nextElementSibling.value);
      if (elem.className == "play-end") {
        seekTime -= 0.1;
      }
      document.querySelector('video').currentTime = seekTime;
    }

    function addCaption(elem) {
      let captionTempl = template.querySelector('#caption-template').cloneNode(true);
      captionTempl.getElementsByClassName('line1')[0].value = "";
      captionTempl.getElementsByClassName('line2')[0].value = "";
      captionTempl.getElementsByClassName('start')[0].value = "00:00:00.000";
      captionTempl.getElementsByClassName('end')[0].value = "00:00:00.000";
      elem.parentElement.parentNode.insertAdjacentElement('afterend', captionTempl);
      makeCaptionEditorActive();
    }

    function deleteCaption(elem) {
      let thisCaption = elem.parentNode.parentNode;
      thisCaption.parentNode.removeChild(thisCaption);
      makeCaptionEditorActive();
    }

    function mergeCaption(elem) {
      let thisCaption = elem.parentNode.parentNode;
      let belowCaption = thisCaption.nextElementSibling;

      thisCaption.querySelector('.end').value = belowCaption.querySelector('.end').value;
      thisCaption.querySelector('.line2').value += 
        ` ${belowCaption.querySelector('.line1').value.toString()} ${belowCaption.querySelector('.line2').value.toString()}`;

      belowCaption.parentNode.removeChild(belowCaption);
      makeCaptionEditorActive();
    }

    function captionChange() {
      makeCaptionEditorActive();
    }

    function makeCaptionEditorActive() {
      updateCaptionsFromTranscript = false;
      document.querySelector('#regenerate-btn').classList.remove("btn-disabled");
      generateCaptionsFromCaptionEditor();
    }

    function generateCaptionsFromCaptionEditor() {

      let vttCaptions = "WEBVTT\n\n";
      let srtCaptions = "";

      document.querySelectorAll('.caption').forEach((caption, index) => {
        if (caption.querySelector('.start').value.length > 0){
          vttCaptions += caption.querySelector('.start').value + " --> " + caption.querySelector('.end').value + "\n";
          vttCaptions += caption.querySelector('.line1').value + "\n";
          if (caption.querySelector('.line2').value.length > 0) {
            vttCaptions += caption.querySelector('.line2').value + "\n";
          }
          vttCaptions += "\n";

          srtCaptions += (index + 1) + "\n";
          srtCaptions += convertTimecodeToSrt(caption.querySelector('.start').value) + " --> " + convertTimecodeToSrt(caption.querySelector('.end').value) + "\n";
          srtCaptions += caption.querySelector('.line1').value + "\n";
          if (caption.querySelector('.line2').value.length > 0) {
            srtCaptions += caption.querySelector('.line2').value + "\n";
          }
          srtCaptions += "\n";
        }
      });

      let track = document.querySelector('#hyperplayer-vtt');
      track.src = "data:text/vtt,"+encodeURIComponent(vttCaptions);

      document
      .querySelector("#download-hypertranscript")
      .setAttribute(
        "href",
        "data:text/html," +
          encodeURIComponent(
            hyperaudioTemplate
              .replace("{hypertranscript}", getTranscriptData())
              .replace("{sourcemedia}", document.querySelector("#hyperplayer").src)
              .replace("{sourcevtt}", track.src)
          )
      );

      document.querySelector('#download-vtt').setAttribute('href', "data:text/vtt,"+encodeURIComponent(vttCaptions));
      document.querySelector('#download-srt').setAttribute('href', "data:text/srt,"+encodeURIComponent(srtCaptions));
    }


    function convertTimecodeToSrt(timecode) {
      //the same as VTT format but milliseconds separated by a comma
      return timecode.substring(0,8) + "," + timecode.substring(9,12);
    }

  </script>
</body>
</html>
